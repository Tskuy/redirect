<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dual Iframe 50/50 Atas Bawah + Close Countdown Overlay</title>

  <style>
    :root{
      --blur-amount: 4px;
      --btn-radius: 999px;
      --btn-bg: rgba(10,10,12,.85);
      --btn-border: rgba(255,255,255,.25);
      --btn-shadow: 0 14px 40px rgba(0,0,0,.45);
    }

    html, body{
      height:100%;
      margin:0;
      padding:0;
      overflow:hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#000;
    }

    /* Container dua iframe 50/50 vertikal (atas–bawah) */
    .iframe-split{
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      width: 100vw;
      height: 100vh;
      background:#000;
      z-index: 1;
    }

    .half-iframe{
      flex: 1 1 50%;
      width: 100vw;
      height: 50vh;
      border: 0;
      display:block;
      background:#000;
    }

    .blur-layer{
      position: fixed;
      inset: 0;
      z-index: 2;
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(var(--blur-amount));
      -webkit-backdrop-filter: blur(var(--blur-amount));
      pointer-events: none;
    }

    .close-wrap{
      position: fixed;
      inset: 0;
      z-index: 3;
      display:grid;
      place-items:center;
    }

    .close-btn{
      appearance: none;
      border: 1px solid var(--btn-border);
      background: var(--btn-bg);
      color:#fff;
      padding: 14px 22px;
      font-size: 15px;
      font-weight: 700;
      border-radius: var(--btn-radius);
      box-shadow: var(--btn-shadow);
      cursor: not-allowed;
      opacity: .65;
      transition: .15s ease;
      text-align:center;
      min-width: 160px;
    }
    .close-btn.enabled{
      cursor: pointer;
      opacity: 1;
    }
    .close-btn.enabled:hover{
      transform: translateY(-1px);
      background: rgba(20,20,24,.95);
    }

    @supports(padding: max(0px)){
      .close-wrap{
        padding-bottom: env(safe-area-inset-bottom);
      }
    }
  </style>
</head>

<body>
  <!-- Dua iframe 50/50 atas–bawah, src di-load setelah klik pertama -->
  <div class="iframe-split" id="iframe-container">
    <iframe
      id="iframe-top"
      class="half-iframe"
      src="about:blank"
      data-src="https://taxdifferenceinvestor.com/rigxzxmw4?key=1083746753524088ad6b003868517a0e"            
      title="Iframe Atas"
      loading="eager"
      referrerpolicy="no-referrer-when-downgrade"
      sandbox="allow-scripts allow-same-origin allow-forms allow-top-navigation-by-user-activation"
    ></iframe>

    <iframe
      id="iframe-bottom"
      class="half-iframe"
      src="about:blank"
      data-src="https://taxdifferenceinvestor.com/rigxzxmw4?key=1083746753524088ad6b003868517a0e"            
      title="Iframe Bawah"
      loading="eager"
      referrerpolicy="no-referrer-when-downgrade"
      sandbox="allow-scripts allow-same-origin allow-forms allow-top-navigation-by-user-activation"
    ></iframe>
  </div>

  <div class="blur-layer" aria-hidden="true"></div>

  <div class="close-wrap" role="dialog" aria-modal="true" aria-label="Close overlay">
    <button id="close-btn" class="close-btn" type="button" disabled>
      Tutup (3)
    </button>
  </div>

  <script>
    (() => {
      const closeBtn = document.getElementById("close-btn");

      /* ===========================
         1) Countdown tombol Tutup
         =========================== */
      let t = 1;
      closeBtn.textContent = `Tutup (${t})`;

      const timer = setInterval(() => {
        t -= 1;
        if (t > 0) {
          closeBtn.textContent = `Tutup (${t})`;
        } else {
          clearInterval(timer);
          closeBtn.disabled = false;
          closeBtn.classList.add("enabled");
          closeBtn.textContent = "Tutup";
        }
      }, 10);

      const delayMs = 1500;

      function smartClose() {
        // Coba hard-close dulu (akan berhasil kalau tab dibuka dari window.open)
        window.open('', '_self');
        window.close();

        // Kalau sampai sini masih jalan, berarti close kemungkinan gagal → fallback
        setTimeout(() => {
          // Jika masih "hidup", lakukan back/redirect
          // (timer tidak akan dieksekusi kalau window benar-benar tertutup)
          if (!document.hidden) {
            if (window.history.length > 1) {
              history.back();
            } else {
              // bisa diganti ke URL lain jika mau
              window.close();
            }
          }
        }, 200);
      }

      closeBtn.addEventListener("click", () => {
        if (closeBtn.disabled) return;
        closeBtn.disabled = true;
        closeBtn.textContent = "Wait..";

        setTimeout(() => {
          smartClose();
        }, delayMs);
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && !closeBtn.disabled) closeBtn.click();
      });

      /* ==========================================
         2) Load iframe hanya saat klik pertama
         ========================================== */

      const loadIframesOnFirstClick = () => {
        const lazyIframes = document.querySelectorAll("iframe[data-src]");
        lazyIframes.forEach((frame) => {
          const url = frame.getAttribute("data-src");
          if (url && frame.src === "about:blank") {
            frame.src = url;
          }
        });
      };

      // Listener sekali saja, klik pertama di mana pun di dokumen
      document.addEventListener(
        "click",
        () => {
          loadIframesOnFirstClick();
        },
        { once: true }
      );

      /* ==========================================
         3) Blokir popup / new tab sebisa mungkin
         ========================================== */

      // Cegah <a target="_blank"> di dokumen utama
      document.addEventListener("click", (e) => {
        const link = e.target.closest("a[target='_blank']");
        if (link) {
          e.preventDefault();
        }
      });

      // Popup dari dalam iframe:
      // diblok lewat sandbox TANPA "allow-popups" di atribut iframe di atas.
    })();
  </script>
</body>
</html>
